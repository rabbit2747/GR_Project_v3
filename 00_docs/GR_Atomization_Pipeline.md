# GR Ontology 원자화 파이프라인

> 최종 수정: 2025-01-29

## 1. 개요

### 1.1 목적
IT 보안 지식을 체계적으로 수집, 정제, 원자화하여 GR Ontology 지식 베이스를 구축한다.

### 1.2 핵심 철학
- IT의 모든 용어, 개념, 제품은 이미 명확하게 정의되어 있음
- 지식의 프랙탈 구조: 하나의 개념을 설명하면 연결된 다른 개념이 필요
- 100% 완성이 목표가 아닌, 지속적 확장이 목표
- 다중 Agent 병렬 처리로 확장 속도 극대화

---

## 2. 파이프라인 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│  1. 소스 리스트업                                            │
│     └── 신뢰도, 정제 수준 분류                               │
├─────────────────────────────────────────────────────────────┤
│  2. 1차 정제 (소스 → 중간 포맷)                              │
│     └── 파서/NLP/LLM 처리                                   │
├─────────────────────────────────────────────────────────────┤
│  3. 중복 검사                                                │
│     └── 기존 DB와 비교, 동일 개념 식별                       │
├─────────────────────────────────────────────────────────────┤
│  4. 정규화                                                   │
│     └── 기준 이름 결정, aliases 매핑                         │
├─────────────────────────────────────────────────────────────┤
│  5. 2차 정제 (원자화)                                        │
│     └── GR Atom 포맷 생성                                   │
├─────────────────────────────────────────────────────────────┤
│  6. 관계 매핑                                                │
│     └── 참조 대상 확인, 없으면 큐에 추가                     │
├─────────────────────────────────────────────────────────────┤
│  7. 검증                                                     │
│     └── 스키마, 관계, 품질 체크                              │
├─────────────────────────────────────────────────────────────┤
│  8. 적재                                                     │
│     └── DB 저장                                             │
├─────────────────────────────────────────────────────────────┤
│  9. 버전 관리 (지속적)                                       │
│     └── 소스 변경 감지, 업데이트 반영                        │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 소스 분류

### 3.1 정제 상태별 분류

#### ✅ 정제됨 (Direct Mapping 가능)
구조화된 스키마, 고유 ID, 관계 정의가 이미 되어있음

| 소스 | 형식 | ID 체계 | 관계 정의 |
|------|------|---------|-----------|
| MITRE ATT&CK | STIX/JSON | T1xxx, TAxxxx | 전술↔기법↔절차 |
| MITRE D3FEND | JSON | D3-xxx | ATT&CK과 연결 |
| MITRE CWE | XML/JSON | CWE-xxx | 부모↔자식 |
| MITRE CAPEC | XML | CAPEC-xxx | CWE와 연결 |
| NVD/CVE | JSON API | CVE-xxxx-xxxxx | CWE, CPE 연결 |
| CISA KEV | JSON | CVE 기반 | CVE 참조 |
| Nuclei Templates | YAML | CVE/자체ID | 태그 분류 |
| Sigma Rules | YAML | UUID | ATT&CK 매핑 |
| MISP Galaxies | JSON | UUID | 클러스터 연결 |
| GTFOBins | 구조화 | 바이너리명 | 기능별 분류 |
| LOLBAS | JSON | 바이너리명 | ATT&CK 매핑 |

#### ⚠️ 반정제 (Parser 처리 필요)
구조는 있으나 추가 처리 필요

| 소스 | 현재 상태 | 필요한 처리 |
|------|-----------|-------------|
| Metasploit Modules | Ruby 코드 + 메타데이터 | 메타데이터 추출 파서 |
| Nmap NSE | Lua + 주석 메타데이터 | 헤더 파싱 |
| Exploit-DB | 텍스트 + 메타데이터 | CVE 매핑, 카테고리 추출 |
| OWASP Top 10 | Markdown/HTML | 섹션별 파싱 |
| OWASP Cheat Sheets | Markdown | 제목/내용 구조화 |
| CIS Benchmarks | PDF/Excel | 컨트롤 항목 추출 |
| NIST SP 800 | PDF | 컨트롤/요구사항 추출 |
| RFC Documents | 텍스트 | 섹션 구조화 |
| YARA Rules | 자체 문법 | 메타데이터 파싱 |

#### 🔧 정제 필요 (NLP/LLM 처리)
비구조화 데이터, 관계 추출 필요

| 소스 | 현재 상태 | 필요한 처리 |
|------|-----------|-------------|
| 벤더 문서 | HTML/PDF | 개념 추출, 관계 파악 |
| 학술 논문 | PDF | 용어 정의 추출, 인용 관계 |
| 교과서 | PDF/텍스트 | 챕터별 개념 추출 |
| 블로그/기술문서 | HTML | 신뢰도 검증 + 정제 |
| 위협 보고서 | PDF | TTP 추출, IOC 추출 |
| 실무 경험 | 비정형 | 체계화 + 검증 |

### 3.2 소스 유형별 분류

#### Tier 1: 구조화된 데이터베이스
- MITRE ATT&CK, D3FEND, CWE, CAPEC
- NVD/CVE, CISA KEV

#### Tier 2: 반구조화된 표준 문서
- OWASP (Top 10, Cheat Sheets, Testing Guide)
- CIS Benchmarks
- NIST SP 800 시리즈
- ISO 27001/27002

#### Tier 3: 도구 기반 데이터베이스
- Metasploit Modules
- Nuclei Templates
- Nmap NSE Scripts
- Exploit-DB
- GTFOBins, LOLBAS

#### Tier 4: 벤더 공식 문서
- Microsoft Docs
- AWS Documentation
- Kubernetes Docs
- Linux Man Pages
- RFC Documents

#### Tier 5: 위협 인텔리전스
- MISP Galaxies
- Sigma Rules
- YARA Rules
- Threat Actor 프로파일

---

## 4. 파이프라인 상세

### 4.1 중복 검사 (Deduplication)

동일 개념이 여러 소스에 존재하는 경우 처리:

```
SQL Injection 예시:
├── MITRE ATT&CK: T1190
├── OWASP Top 10: A03
├── CWE: CWE-89
├── Metasploit: 수십 개 모듈
└── Nuclei: 수백 개 템플릿
```

**처리 방안:**
- 개념 자체는 하나의 Atom으로 통합
- 각 소스별 정보는 `metadata.references`에 기록
- 도구/템플릿은 별도 Atom으로 생성 후 연결

### 4.2 정규화 (Normalization)

동일 개념의 다양한 표현 통합:

| 소스 | 표현 |
|------|------|
| MITRE | "Credential Dumping" |
| 실무 | "크리덴셜 덤핑" |
| 도구 | "hashdump" |
| 학술 | "Credential Extraction" |

**처리 방안:**
- `identity.name`: 표준 이름 (영문 기준)
- `identity.aliases`: 모든 별칭 포함
- `identity.normalization.normalized_name`: 검색용 정규화 이름

### 4.3 관계 자동 매핑

원자화 중 발견된 참조 처리:

```yaml
# 원자화 중 참조 발견
definition:
  what: "SQL 쿼리에 악의적인 코드 삽입..."

# 처리 로직:
# 1. "SQL 쿼리" → DB에 있는지 확인
# 2. 없으면 → 생성 대기열(Queue)에 추가
# 3. 있으면 → 관계 연결
```

### 4.4 검증 (Validation)

원자화 후 품질 체크:

- [ ] 필수 필드 존재 여부 (identity.id, identity.name, classification, definition)
- [ ] ID 형식 준수 (카테고리-서브카테고리-이름-시퀀스)
- [ ] 관계 대상 존재 여부
- [ ] 순환 참조 없음
- [ ] 추상화 레벨 적절성 (Level 1~4)

### 4.5 버전 관리

소스 업데이트 대응:

```
MITRE ATT&CK v14 → v15
├── 새 기법 추가됨 → 신규 Atom 생성
├── 기존 기법 수정됨 → 기존 Atom 업데이트
└── 일부 기법 deprecated → Atom 상태 변경
```

### 4.6 충돌 해결

동일 개념의 상충되는 정의:

**우선순위:**
1. 공식 표준 (NIST, ISO)
2. 업계 표준 (MITRE, OWASP)
3. 벤더 문서
4. 학술 자료
5. 커뮤니티 자료

---

## 5. 작업 우선순위

### Phase 1: 뼈대 구축 (정제된 소스)
- MITRE ATT&CK → 공격의 표준
- MITRE CWE → 취약점의 표준
- MITRE D3FEND → 방어의 표준
- OWASP Top 10s → 웹 보안의 표준

### Phase 2: 살 붙이기 (반정제 소스)
- NVD/CVE → 실제 취약점
- Metasploit → 실제 공격 도구
- Nuclei → 실제 탐지 방법
- CIS Benchmarks → 실제 하드닝

### Phase 3: 확장 (정제 필요 소스)
- 벤더 문서
- RFC
- 학술 자료

---

## 6. Agent 운영 구조

```
┌─────────────────────────────────────────────────────────┐
│                    지식 수집 소스들                       │
├─────────────────────────────────────────────────────────┤
│  MITRE ATT&CK  │  OWASP  │  CVE  │  논문  │  실무경험  │
└────────┬───────┴────┬────┴───┬───┴───┬────┴─────┬──────┘
         │            │        │       │          │
         ▼            ▼        ▼       ▼          ▼
┌─────────────────────────────────────────────────────────┐
│              다수의 Agent 병렬 처리                      │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐              │
│  │ A1  │ │ A2  │ │ A3  │ │ A4  │ │ ... │              │
│  └──┬──┘ └──┬──┘ └──┬──┘ └──┬──┘ └──┬──┘              │
└─────┼───────┼───────┼───────┼───────┼──────────────────┘
      │       │       │       │       │
      ▼       ▼       ▼       ▼       ▼
┌─────────────────────────────────────────────────────────┐
│                    GR Ontology DB                        │
│                                                          │
│   원자화 중 발견된 용어 → 다시 원자화 대상으로 추가        │
│                     (재귀적 확장)                         │
└─────────────────────────────────────────────────────────┘
```

---

## 7. 참고

- GR Atom 스키마: `01_schema/gr_atom_schema.yaml`
- 프로젝트 현황: `00_docs/GR_Project_Status.md`
