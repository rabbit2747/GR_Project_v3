# GR Atom: Cloud Metadata Service Attack
# Version: 1.0
# Created: 2025-01-29

identity:
  id: "ATK-CLOUD-METADATA-001"
  name: "Cloud Metadata Service Attack"
  normalization:
    normalized_name: "cloud metadata imds ssrf credential theft aws azure gcp"
    normalization_version: "1.0"
  aliases:
    - "메타데이터 서비스 공격"
    - "IMDS 공격"
    - "클라우드 자격 증명 탈취"

classification:
  domain: security
  type: technique
  abstraction_level: 2
  gr_coordinates:
    layer: "L5"
    zone: "Z1"
    tags: ["ATK", "CLOUD", "METADATA"]

definition:
  what: |
    클라우드 메타데이터 서비스 공격은 SSRF나 RCE를 통해 클라우드
    인스턴스의 메타데이터 서비스에 접근하여 자격 증명을 탈취한다.
  why: |
    메타데이터 서비스는 IAM 자격 증명을 제공한다.
    탈취된 자격 증명으로 클라우드 리소스 전체 접근이 가능하다.
  how: |
    1. SSRF 또는 RCE 취약점 발견
    2. 메타데이터 엔드포인트 접근
    3. IAM 역할 자격 증명 획득
    4. 클라우드 API로 추가 공격

relations:
  structural:
    is_a:
      - "VUL-WEB-SSRF-001"

properties:
  technical:
    metadata_endpoints:
      - name: "AWS IMDS"
        url: "http://169.254.169.254/latest/"
        paths:
          - "meta-data/iam/security-credentials/"
          - "meta-data/iam/info"
          - "user-data"
        versions:
          - v1: "취약 (단순 HTTP)"
          - v2: "안전 (토큰 필요)"
      - name: "Azure IMDS"
        url: "http://169.254.169.254/metadata/"
        header: "Metadata: true"
        paths:
          - "instance/compute"
          - "identity/oauth2/token"
      - name: "GCP Metadata"
        url: "http://metadata.google.internal/"
        header: "Metadata-Flavor: Google"
        paths:
          - "computeMetadata/v1/"
          - "instance/service-accounts/"
    attack_scenarios:
      - name: "SSRF를 통한 접근"
        description: "웹 취약점으로 내부 요청"
      - name: "RCE 후 접근"
        description: "명령 실행 후 curl/wget"
      - name: "리버스 프록시 우회"
        description: "Host 헤더 조작"
    prevention:
      - name: "AWS IMDSv2"
        method: "PUT 토큰 요청 필요"
        effect: "SSRF로 토큰 획득 불가"
      - name: "방화벽 규칙"
        method: "메타데이터 IP 차단"
      - name: "최소 권한 IAM"
        method: "역할 권한 제한"
      - name: "네트워크 세그멘테이션"
        method: "컨테이너/서버 격리"
    detection:
      - "메타데이터 접근 로깅"
      - "비정상 IAM 활동"
      - "CloudTrail/Activity Log"

metadata:
  trust:
    source: official
    references:
      - "AWS IMDS Documentation"
      - "OWASP Cloud Security"
    confidence: 1.0
    verified:
      status: verified
      date: 2025-01-29
      by: "GR System"
  temporal:
    created: 2025-01-29
    modified: 2025-01-29
    revision: 1
  security:
    sensitivity: public
  ai:
    embedding_text: |
      클라우드 메타데이터 공격은 SSRF로 IAM 자격 증명을 탈취한다. AWS IMDSv2,
      방화벽 규칙, 최소 권한으로 방어한다.
    search_keywords:
      - "메타데이터 공격"
      - "IMDS"
      - "클라우드 SSRF"
      - "IAM 탈취"
    related_queries:
      - "AWS 메타데이터"
      - "클라우드 보안"
      - "SSRF 클라우드"
